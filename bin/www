#!/usr/bin/env node
var debug = require('debug')('slacked');
var appArgs = require('minimist')(process.argv.slice(2));
var fs = require('fs');
global.appConfig = {};


// Setup config
if (appArgs.c) {
  try {
    global.appConfig = require(appArgs.c);
  } catch (e) {
    try {
      global.appConfig = require('../config.json');
    } catch (e) {
      global.appConfig = {"port": 3000, "debug": true, "token": "", redis: {}};
    }
  }
} else {
  try {
    global.appConfig = require('../config.json');
  } catch (e) {
    global.appConfig = {"port": 3000, "debug": true, "token": "", redis: {}};
  }
}

// Require custom modules
var slackService = require('../lib/slackService');
var app = require('../app');
var redisCache = require('../lib/redisCache');

// Setup custom modules
if (appArgs.p) {
  app.set('port', appArgs.port || appArgs.p);
} else {
  app.set('port', 3000);
}

// Start services
// Web Service
var server = app.listen(app.get('port'), function() {
  debug('Express server listening on port ' + server.address().port);
});

// Slack Service
slackService.start();

// Redis Service
redisCache.start();

// Testing Services
var sqlUtil = require('../lib/sqlUtil');
sqlUtil.testSQL();
redisCache.test();
