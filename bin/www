#!/usr/bin/env node
var appArgs = require('minimist')(process.argv.slice(2));
var fs = require('fs');
global.appConfig = {};


// Setup config
// This is ugly needs changing
if (appArgs.c) {
  try {
    global.appConfig = require(appArgs.c);
  } catch (e) {
    try {
      global.appConfig = require('../config.json');
    } catch (e) {
      global.appConfig = {"port": 3000, "debug": true, "token": "", redis: {}};
    }
  }
} else {
  try {
    global.appConfig = require('../config.json');
  } catch (e) {
    global.appConfig = {"port": 3000, "debug": true, "token": "", redis: {}};
  }
}

// Services
var redisCache = require('../lib/redisCache');
redisCache.start();



var app = require('../app');


// Setup custom modules
if (appArgs.p) {
  app.set('port', appArgs.port || appArgs.p);
} else {
  app.set('port', 3000);
}

// Start services
// Web Service
var server = app.listen(app.get('port'), function() {
  console.log('Express server listening on port ' + server.address().port);
});

// Testing Services
var sqlUtil = require('../lib/sqlUtil');
sqlUtil.testSQL();
redisCache.test();
